{% extends "base.html" %}
{% load django_bootstrap5 %}
{% bootstrap_css %}
{% bootstrap_javascript %}
{% load mathfilters %}

{% block title %}
機械一覧
{% endblock %}

{% block page-title %}
機械一覧
{% endblock %}


{% block body %}
<div class="container-fluid">
  <div class="row">
    <div class="col-sm-12">
      <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab" aria-controls="home" aria-selected="true">
            機械一覧（{{num}}件）
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="filter-tab" data-bs-toggle="tab" data-bs-target="#filter" type="button" role="tab" aria-controls="filter" aria-selected="false">検索</button>
        </li>
      </ul>
      <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
          <div class="card">
            <div class="card-body table-responsive">
              <p>
                {% for k, v in params_dict.items %}
                {% if not v == "" %}
                <label class="badge {%if k == 'order_by'%}bg-warning{%else%}bg-info{%endif%} text-black">
                  {{k}}: {{v}}
                </label>
                {% endif %}
                {% endfor %}
              </p>
              <table class="table">
                <tr class="bg-info">
                  <th>No</th>
                  <th>機械名</th>
                  <th>機械種別</th>
                </tr>
                {% for object in object_list %}
                <tr>
                  <td>
                    <a href="{% url 'factory:machine_detail' pk=object.pk %}">{{object.pk}}</a>
                  </td>
                  <td>{{object.name}}</td>
                  <td>{{object.machine_type.name}}</td>
                </tr>
                {% empty %}
                <tr>
                  <td>該当なし</td>
                </tr>
                {% endfor %}
              </table>
            </div>
            <div class="card-footer">
              {% if page_obj.has_other_pages %}
              <nav>
                <ul class="pagination">
                  <!--previous-->
                  {% if page_obj.has_previous %}
                  <li class="page-item">
                    <a class="page-link"
                      href="{%url 'factory:machine_list'%}?page={{page_obj.previous_page_number}}{{params}}"
                    >&laquo;</a>
                  </li>
                  {% else %}
                  <li class="page-item disabled"><a class="page-link">&laquo;</a></li>
                  {% endif %}
                  <!--first-->
                  {% if page_obj.number|sub:5 > 0 %}
                  <li class="page-item">
                    <a class="page-link"
                      href="{%url 'factory:machine_list'%}?page=1{{params}}"
                    >1</a>
                  </li>
                  {% endif %}
                  <!--pages-->
                  {% for i in page_obj.paginator.page_range %}
                  {% if page_obj.number == i %}
                  <li class="page-item active">
                    <a class="page-link" href="#">{{i}}</a>
                  </li>
                  {% elif page_obj.number|sub:i < 5 and page_obj.number|sub:i > -5 %}
                  <li class="page-item">
                    <a class="page-link"
                      href="{%url 'factory:machine_list'%}?page={{i}}{{params}}"
                    >{{i}}</a>
                  </li>
                  {% elif page_obj.number|sub:i == 5 or page_obj.number|sub:i == -5 %}
                  <li class="disabled">
                    <a class="page-link text-secondary d-inline-block text-muted" href="#">・・・</a>
                  </li>
                  {% endif %}
                  {% endfor %}
                  <!--last-->
                  {% if not page_obj.number == page_obj.paginator.num_pages and page_obj.paginator.num_pages > 5%}
                  <li class="page-item">
                    <a class="page-link"
                      href="{%url 'factory:machine_list'%}?page={{page_obj.paginator.num_pages}}{{params}}"
                    >{{page_obj.paginator.num_pages}}</a>
                  </li>
                  {% endif %}
                  <!--next-->
                  {% if page_obj.has_next %}
                  <li class="page-item">
                    <a class="page-link"
                      href="{%url 'factory:machine_list'%}?page={{page_obj.next_page_number}}{{params}}"
                    >&raquo;</a>
                  </li>
                  {% else %}
                  <li class="page-item disabled"><a class="page-link">&raquo;</a></li>
                  {% endif %}
                </ul>
              </nav>
              {% endif %}
            </div>
          </div>
        </div>
        <div class="tab-pane fade" id="filter" role="tabpanel" aria-labelledby="filter-tab">
          <div class="card">
            <form class="form" method="GET" id='searchForm'>
              <div class="card-body table-responsive">
                {% for f in search_form %}
                {% if not 'spec_' in f.name %}
                <p>
                  {{f.label}}
                  {{f}}
                </p>
                {% endif %}
                {% endfor %}
                <h5>機械スペック</h5>
                <div class="accordion" id="accordion_spec">
                  {% for k,v in specs.items %}
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="headingOne">
                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#{{k}}" aria-expanded="false" aria-controls="{{k}}">
                        {{v}}
                      </button>
                    </h2>
                    <div id="{{k}}" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordion_spec">
                      <div class="accordion-body">
                        {% for f in search_form %}
                        {% if 'spec_'|add:k in f.name %}
                        <p>
                          {{f.label}}
                          {{f}}
                        </p>
                        {% endif %}
                        {% endfor %}
                      </div>
                    </div>
                  </div>
                  {% endfor %}
                </div>
                <button type="submit" class="btn btn-sm btn-primary" id='submit'>
                  <i class="fas fa-search"></i>&nbsp;検索
                </button>
                <a href="{% url 'factory:factory_list' %}" class="btn btn-sm btn-secondary">
                  <i class="fas fa-undo"></i>&nbsp;クリア
                </a>
              </div>
            </form>
          </div>
        </div>
      </div>
      
    </div>
  </div>
</div>
{% endblock %}

{% block js %}
<script>
  $('form#searchForm').submit(function() {
    $(':input', this).each(function() {
        this.disabled = !($(this).val());
    });
  });
</script>
{% endblock %}